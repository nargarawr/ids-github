<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <!-- Necessary style sheets -->
 <link href="css/flot.css" rel="stylesheet" type="text/css">
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="css/shiny.css"/>  
  <link rel="stylesheet" type="text/css" href="css/jquery.slider.min.css"/>
  <link rel="stylesheet" type="text/css" href="css/bootstrap-responsive.min.css"/>
  <link rel="stylesheet" type="text/css" href="css/cxk-auxStyles.css"/>
  


  <!-- Necessary functionality Javascript files-->
  <script language="javascript" type="text/javascript" src="js/jquery.js"></script>
  <script language="javascript" type="text/javascript" src="js/jquery.flot.js"></script>


  <script src="js/shiny.js" type="text/javascript"></script>
  <script src="js/jquery.slider.min.js"></script>
  <script src="js/boostrap-tooltip.js"></script>
  <script src="js/bootstrap.min.js"></script>

  <title>Type-1 System</title>
  <script type="text/javascript">
    var modalCurId;

    function triMemFun (name, left, mean, right, height) {
      this.funName            = name;
      this.funType            = "tri";
      this.paramLeft          = left;
      this.paramMean          = mean;
      this.paramRight         = right;
      this.paramHeight        = height; 
    }

    function trapMemFun (name, lfoot, lshould, rshould, rfoot, height) {
      this.funName            = name;
      this.funType            = "trp";
      this.paramLeftFoot      = lfoot;
      this.paramLeftShoulder  = lshould;
      this.paramRightShoulder = rshould;
      this.paramRightFoot     = rfoot;
      this.paramHeight        = height; 
    }

    function gauMemFun (name, sigma, mean, height){
      this.funName            = name;
      this.funType            = "gau";
      this.paramSigma         = sigma;
      this.paramMean          = mean;
      this.paramHeight        = height;
    }

    function gau2MemFun (name, lsigma, lmean, rsigma, rmean, height) {
      this.funName            = name;
      this.funType            = "ga2";
      this.paramLeftSigma     = lsigma;
      this.paramLeftMean      = lmean;
      this.paramRightSigma    = rsigma;
      this.paramRightMean     = rmean;
      this.paramHeight        = height;      
    }

    function errorsInFunction (arr) {
      if ( arr[0] === "" ){
        return 1;
      }

      for (i = 1 ; i < arr.length; i++){
        if ( isNaN (arr[i]) || arr[i] === "") {
          return 2;  
        }       
      }

      return 0;
    }

   	function createMembershipFunction() {
      var s = document.getElementById ( 'mfTypeSelect' );
      var opt = s.options[s.selectedIndex].value;
      var mfName = document.getElementById('inputFunName').value;
      var pHeight = document.getElementById('inputHeight').value;  

      if ( opt == "gaussMF" ){
        var pSigma = document.getElementById('inputSigma').value;  
        var pMean = document.getElementById('inputMean').value;  
      
        var vals = [mfName, pSigma, pMean, pHeight];
        var errCode = errorsInFunction(vals);
        if ( errCode === 1 ){
          alert ( "Error: No function name specified" );
        } else if ( errCode === 2 ) {
          alert ( "Error: Some parameters were not numbers, or were blank" );
        } else {
          // No Errors
          var mf = new gauMemFun (mfName, pSigma, pMean, pHeight);
          drawMf(mf);
        }
      } else if ( opt == "gaussbMF" ){
        var pLSigma = document.getElementById('inputLSigma').value;  
        var pLMean = document.getElementById('inputLMean').value;  
        var pRSigma = document.getElementById('inputRSigma').value;  
        var pRMean = document.getElementById('inputRMean').value;  

        var vals = [mfName, pLSigma, pLMean, pRSigma, pRMean, pHeight];
        var errCode = errorsInFunction(vals);
        if ( errCode === 1 ){
          alert ( "Error: No function name specified" );
        } else if ( errCode === 2 ) {
          alert ( "Error: Some parameters were not numbers, or were blank" );
        } else {
          // No Errors
          var mf = new gau2MemFun (mfName, pLSigma, pLMean, pRSigma, pRMean, pHeight);
          drawMf(mf);
        }
      } else if ( opt == "triMF" ){
        var pLeft = document.getElementById('inputLeft').value;  
        var pMean = document.getElementById('inputMean').value;  
        var pRight = document.getElementById('inputRight').value;  

        var vals = [mfName, pLeft, pMean, pRight, pHeight];
        var errCode = errorsInFunction(vals);
        if ( errCode === 1 ){
          alert ( "Error: No function name specified" );
        } else if ( errCode === 2 ) {
          alert ( "Error: Some parameters were not numbers, or were blank" );
        } else {
          // No Errors
          var mf = new triMemFun (mfName, pLeft, pMean, pRight, pHeight);
          drawMf(mf);
        }
      } else if ( opt == "trapMF" ){
        var pLFoot = document.getElementById('inputLFoot').value;  
        var pLShould = document.getElementById('inputLShoulder').value;  
        var pRShould = document.getElementById('inputRShoulder').value;  
        var pRFoot = document.getElementById('inputRFoot').value;  

        var vals = [mfName, pLFoot, pLShould, pRShould, pRFoot, pHeight];
        var errCode = errorsInFunction(vals);
        if ( errCode === 1 ){
          alert ( "Error: No function name specified" );
        } else if ( errCode === 2 ) {
          alert ( "Error: Some parameters were not numbers, or were blank" );
        } else {
          // No Errors
          var mf = new trapMemFun (mfName, pLFoot, pLShould, pRShould, pRFoot, pHeight);
          drawMf(mf);
        }
      } else {
        alert("An error has occured. The specified membership function could not be created");
      }
      doSomethingWithMf(mf);
  	}

    function getMfVals (maxRange, minRange, mf){
      var xVals = new Array();
      var yVals = new Array();

      for ( var i = minRange; i <= maxRange; i++){
        xVals[i] = i;
        yVals[i] = i * mf.paramHeight;
      }

      var obj = new pair (xVals,yVals);
      return obj;
    }

    function pair (m_left, m_right) {
      this.left = m_left;
      this.right = m_right;
    }

    function drawMf(mf){
      $(function() {
        maxRange = 10;
        minRange = 0;
        var mfVals = getMfVals(maxRange, minRange, mf);
        var xVals = mfVals.left;
        var yVals = mfVals.right;

        var d1 = new Array();
        for ( var i = 0 ; i < xVals.length; i++){
          var x = [xVals[i], yVals[i]];
          d1[i] = x;
        }

        $.plot("#placeholder", [ d1 ]);
      });
    }

    function doSomethingWithMf (mf) {
      var d = document.getElementById(modalCurId);     
      d.appendChild(document.createTextNode(mf.funName));      
    }

    function setModalId(id){
      modalCurId = id;

      document.getElementById("inputFunName").value="";     
      document.getElementById("ga1f").selected=true;     
      updateModal("mfTypeSelect");
    }

    function addElements ( id , mfType ){
      if ( mfType == "gaussMF" ) {
        var inputBox1 = document.createElement("input");
        inputBox1.id = "inputSigma";
        var inputBox2 = document.createElement("input");
        inputBox2.id = "inputMean";

        id.appendChild(document.createTextNode("Sigma"));
        id.appendChild((document.createElement("br")));
        id.appendChild(inputBox1);
        id.appendChild((document.createElement("br")));
        id.appendChild(document.createTextNode("Mean"));
        id.appendChild((document.createElement("br")));
        id.appendChild(inputBox2);
        id.appendChild((document.createElement("br")));      
      } else if ( mfType == "gaussbMF" ) {
        var inputBox1 = document.createElement("input");
        inputBox1.id = "inputLSigma";
        var inputBox2 = document.createElement("input");
        inputBox2.id = "inputLMean";
        var inputBox3 = document.createElement("input");
        inputBox3.id = "inputRSigma";
        var inputBox4 = document.createElement("input");
        inputBox4.id = "inputRMean";

        id.appendChild(document.createTextNode("Left Sigma"));
        id.appendChild((document.createElement("br")));
        id.appendChild(inputBox1);
        id.appendChild((document.createElement("br")));
        id.appendChild(document.createTextNode("Left Mean"));
        id.appendChild((document.createElement("br")));
        id.appendChild(inputBox2);
        id.appendChild((document.createElement("br")));
        id.appendChild(document.createTextNode("Right Sigma"));
        id.appendChild((document.createElement("br")));
        id.appendChild(inputBox3);
        id.appendChild((document.createElement("br")));
        id.appendChild(document.createTextNode("Right Mean"));
        id.appendChild((document.createElement("br")));
        id.appendChild(inputBox4);
        id.appendChild((document.createElement("br")));
      } else if ( mfType == "triMF" ) {
        var inputBox1 = document.createElement("input");
        inputBox1.id = "inputLeft";
        var inputBox2 = document.createElement("input");
        inputBox2.id = "inputMean";
        var inputBox3 = document.createElement("input");
        inputBox3.id = "inputRight";

        id.appendChild(document.createTextNode("Left"));
        id.appendChild((document.createElement("br")));
        id.appendChild(inputBox1);
        id.appendChild((document.createElement("br")));
        id.appendChild(document.createTextNode("Mean"));
        id.appendChild((document.createElement("br")));
        id.appendChild(inputBox2);
        id.appendChild((document.createElement("br")));
        id.appendChild(document.createTextNode("Right"));
        id.appendChild((document.createElement("br")));
        id.appendChild(inputBox3);
        id.appendChild((document.createElement("br")));
      } else if ( mfType == "trapMF" ) {
        var inputBox1 = document.createElement("input");
        inputBox1.id = "inputLFoot";
        var inputBox2 = document.createElement("input");
        inputBox2.id = "inputLShoulder";
        var inputBox3 = document.createElement("input");
        inputBox3.id = "inputRShoulder";
        var inputBox4 = document.createElement("input");
        inputBox4.id = "inputRFoot";

        id.appendChild(document.createTextNode("Left Foot"));
        id.appendChild((document.createElement("br")));
        id.appendChild(inputBox1);
        id.appendChild((document.createElement("br")));
        id.appendChild(document.createTextNode("Left Shoulder"));
        id.appendChild((document.createElement("br")));
        id.appendChild(inputBox2);
        id.appendChild((document.createElement("br")));
        id.appendChild(document.createTextNode("Right Shoulder"));
        id.appendChild((document.createElement("br")));
        id.appendChild(inputBox3);
        id.appendChild((document.createElement("br")));
        id.appendChild(document.createTextNode("Right Foot"));
        id.appendChild((document.createElement("br")));
        id.appendChild(inputBox4);
        id.appendChild((document.createElement("br")));
      } else {
        alert("Invalid option selected or option not yet supported");
      }  

      var inputBox5 = document.createElement("input");        
      inputBox5.id = "inputHeight";

      id.appendChild(document.createTextNode("Height"));  
      id.appendChild((document.createElement("br")));
      id.appendChild(inputBox5);
    }

    function updateModal (selectionId) {


      var s = document.getElementById ( 'mfTypeSelect' );
      var opt = s.options[s.selectedIndex].value;
 
      var vo = document.getElementById ( "variableOptions" ) ;    
      if ( vo.hasChildNodes() ) {
        while ( vo.childNodes.length >= 1 ) {
          vo.removeChild( vo.firstChild );       
        } 
      }

      addElements ( vo, opt );
    }
   $(function() {
        var d2 = [[0, 0]];
        $.plot("#placeholder", [ d2 ]);
    });
  </script>

</head>

<body>

<div class="container-fluid">
  <div class="row-fluid">
    <div class="span12" style="padding: 10px 0px;">
      <h1>Type-1 System</h1>
    </div>
  </div>
  <div class="row-fluid">
    <div class="span2">
      <form class ="well">
      </form>
    </div>
    <div class="span10">
      <div class="tabbable">
        <ul class="nav nav-tabs">
          <li class="active">
            <a href="#tab-inputs" data-toggle="tab">Inputs</a>
          </li>
          <li>
            <a href="#tab-outputs" data-toggle="tab">Outputs</a>
          </li>
        </ul>
        <div class="tab-content">
          <div class="tab-pane active" id="tab-inputs">      
          <div id="inputDiv1">
            <a data-toggle="modal" href="#myModal" class="btn btn-primary" onClick="setModalId('inputDiv1')">Open Modal 1</a>
          </div>  
          <div id="inputDiv2">
            <a data-toggle="modal" href="#myModal" class="btn btn-primary" onClick = "setModalId('inputDiv2')">Open Modal 2</a>
          </div>  	
			<!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			    <div class="modal-dialog">
			      <div class="modal-content">
			        <div class="modal-header">
			          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
			          <h4 class="modal-title">Membership Function Creator</h4>
			        </div>
			        <div class="modal-body">
			          <form style="float:left;">
                  <p class="titleText" >Function name</p>
                  <input id="inputFunName">
                  <br />
			          	<p style="padding-top:5px" class="titleText">Function type</p>
			          	<select id="mfTypeSelect" onChange="updateModal();">
			          		 <option value="gaussMF" id="ga1f">  Gaussian </option>
							       <option value="gaussbMF" id="ga2f"> 2-Part Gaussian </option>
							       <option value="triMF" id="timf">    Triangular </option>
							       <option value="trapMF" id="tpmf">   Trapezoidal </option>			          		
			          	</select>
                  <p class="titleText">Parameters</p>
                  <div id="variableOptions"></div>
			          </form>
                  <div id="demo-contain"class="demo-container" style="float:right;">
                    <div id="placeholder" class="demo-placeholder">
                    </div>
                  </div>
  		        </div>
			        <div class="modal-footer">
			          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>

                <!-- Launch modal window and pass in the id of the div that the button being pressed is inside -->
			          <button type="button" class="btn btn-primary" onClick='createMembershipFunction()' id="inputBtn1">Save changes</button>
			        </div>
			      </div><!-- /.modal-content -->
			    </div><!-- /.modal-dialog -->
			  </div><!-- /.modal -->
           </div>
          <div class="tab-pane" id="tab-outputs">        
            <div id="mainDivOutput">                    
            </div>
           </div>
        </div>
      </div>
  </div>
</div>
</div>
<!--
                  <div class="demo-container">
                    <div id="placeholder" class="demo-placeholder">
                    </div>
                  </div>-->

</body>
</html>
